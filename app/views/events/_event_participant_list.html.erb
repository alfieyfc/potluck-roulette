<table class="table table-hover table-condensed">
  <thead>
    <tr>
      <th scope="col" colspan="2" class="text-center">Participant</th>
      <th scope="col" colspan="5">Main Ingredient</th>
      <th scope="col" colspan="5">Cuisine Style</th>
      <th scope="col" colspan="5">Dish</th>
    </tr>
  </thead>
  <tbody>
    <% Participation.where(event_id: @event.id).order(:created_at).each do |participation| %>
      <% user = User.find_by(id: participation.user_id) %>
      <tr>
        <td scope="col" colspan="1">
          <% if user.id == @event.owner.id %>
            <i><strong><%= user.name %></strong></i>
          <% else %>
            <%= user.name %>
          <% end %>
          <% if (current_user == user || current_user.id == @event.owner.id) && (participation.main_ingredient_id && participation.cuisine_style_id) %>
            <%= button_to "Reset", reset_ingredient_style_path, params: {event_id: @event.id, user_id: user.id}, method: :get, class: "btn-sm btn-secondary w-100" %>
          <% end %>
        </td>

        <td scope="col" colspan="1">
          <% if user.id == @event.owner_id %>
            <i><strong>Host</strong></i>
          <% else %>
            Guest
          <% end %>
        </td>

        <% if participation.main_ingredient_id && participation.cuisine_style_id %>
          <td scope="col" colspan="5">
              <%= Ingredient.find(participation.main_ingredient_id).name %>
          </td>
          <td scope="col" colspan="5">
              <%= CuisineStyle.find(participation.cuisine_style_id).name %>
          </td>

        <% else %>
          <td scope="col" colspan="10">
            <% if current_user == user %>
              <%= button_to "Draw!", draw_ingredient_style_path, params: {event_id: @event.id}, method: :get, class: "btn-sm btn-primary w-100" %>
            <% elsif current_user.id == @event.owner_id%>
              <%= button_to "Draw for guest!", draw_ingredient_style_path, params: {event_id: @event.id}, method: :get, class: "btn-sm btn-secondary w-100" %>
            <% end %>
          </td>
        <% end %>


        <td scope="col" colspan="5">
          <% btn_txt = "Upload Dish" %>
          <% Dish.where(event_id: @event.id, user_id: user.id).each do |dish| %>
            <p><%= link_to dish.name, dish_path(dish) %></p>
            <% btn_txt = "Upload More" %>
          <% end %>
          <% if current_user.id == user.id %>
            <%= button_to btn_txt, new_dish_path, params: {event_id: @event.id}, method: :get, class: "btn-sm btn-primary w-100" %>
          <% end %>
        </td>

      </tr>
    <% end %>
  </tbody>
</table>
